<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Communications ATC - VFR Radio Phrase Guide</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 700px;
    margin: 20px auto;
    padding: 10px;
    background: #f0f4f8;
    color: #222;
  }
  h1 {
    text-align: center;
    color: #dc3545;
  }
  .lang-switch {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-bottom: 16px;
  }
  .lang-switch button {
    background: #fce8e6;
    color: #dc3545;
    border: 1px solid #dc3545;
    border-radius: 4px;
    padding: 6px 14px;
    font-weight: bold;
    cursor: pointer;
  }
  .lang-switch button.active {
    background: #dc3545;
    color: #fff;
  }
  .options-switch {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-bottom: 16px;
  }
  .options-switch button {
    background: #fce8e6;
    color: #dc3545;
    border: 1px solid #dc3545;
    border-radius: 4px;
    padding: 6px 14px;
    font-weight: bold;
    cursor: pointer;
  }
  .options-switch button.active {
    background: #dc3545;
    color: #fff;
  }
  .back-button {
    display: inline-block;
    margin-bottom: 20px;
    background: #6c757d;
    color: white;
    text-decoration: none;
    padding: 8px 16px;
    border-radius: 4px;
    font-weight: bold;
  }
  .back-button:hover {
    background: #5a6268;
  }
  label {
    display: block;
    margin-top: 12px;
    font-weight: bold;
  }
  input, select {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
    font-size: 1rem;
    border: 1px solid #bbb;
    border-radius: 4px;
  }
  button[type="submit"] {
    margin-top: 20px;
    background-color: #dc3545;
    color: white;
    border: none;
    padding: 12px 20px;
    font-size: 1.1rem;
    border-radius: 5px;
    cursor: pointer;
  }
  button[type="submit"]:hover {
    background-color: #c82333;
  }
  .phrase {
    background: #fce8e6;
    color: #721c24;
    font-weight: bold;
    padding: 8px 10px;
    border-radius: 4px;
    margin-bottom: 8px;
    display: block;
  }
  details {
    margin-bottom: 12px;
    background: #fff;
    border: 1px solid #f8d7da;
    border-radius: 4px;
    padding: 6px 10px;
  }
  summary {
    font-weight: bold;
    cursor: pointer;
    color: #dc3545;
  }
  .step-title {
    font-weight: bold;
    font-size: 1.15em;
    margin: 18px 0 8px 0;
    color: #dc3545;
  }
  .info-box {
    background: #d1ecf1;
    border: 1px solid #bee5eb;
    border-radius: 4px;
    padding: 15px;
    margin-bottom: 20px;
    color: #0c5460;
  }
  .alt-type-btn {
    background: #fce8e6;
    color: #dc3545;
    border: 1px solid #dc3545;
    border-radius: 4px;
    padding: 6px 12px;
    font-weight: bold;
    cursor: pointer;
  }
  .alt-type-btn.active {
    background: #dc3545;
    color: #fff;
  }
  .alt-type-btn-small {
    background: #f8f9fa;
    color: #6c757d;
    border: 1px solid #dee2e6;
    border-radius: 3px;
    padding: 3px 8px;
    font-size: 0.75em;
    font-weight: normal;
    cursor: pointer;
    margin-right: 5px;
  }
  .alt-type-btn-small.active {
    background: #dc3545;
    color: #fff;
    border-color: #dc3545;
  }
  .phonetic-helper {
    margin: 20px 0;
    border: 1px solid #ddd;
    border-radius: 8px;
    background: #f8f9fa;
  }

  .phonetic-helper summary {
    padding: 15px;
    cursor: pointer;
    background: #e9ecef;
    border-radius: 8px 8px 0 0;
    transition: background-color 0.3s;
  }

  .phonetic-helper summary:hover {
    background: #dee2e6;
  }

  .phonetic-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 8px;
    padding: 15px;
  }

  .phonetic-item {
    background: white;
    padding: 8px;
    border-radius: 4px;
    text-align: center;
    font-size: 0.9em;
    border: 1px solid #e9ecef;
  }

  .callsign-converter {
    margin: 20px 0;
    border: 1px solid #ddd;
    border-radius: 8px;
    background: #f8f9fa;
  }

  .callsign-converter summary {
    padding: 15px;
    cursor: pointer;
    background: #e7f3ff;
    border-radius: 8px 8px 0 0;
    transition: background-color 0.3s;
  }

  .callsign-converter summary:hover {
    background: #d1ecf1;
  }

  .callsign-converter > div {
    padding: 15px;
  }

  .callsign-converter input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 16px;
  }

  /* Responsive pour mobile */
  @media (max-width: 768px) {
    .phonetic-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .phonetic-item {
      font-size: 0.8em;
      padding: 6px;
    }
  }
</style>
</head>
<body>

<a href="index.html" class="back-button">‚Üê Retour au menu principal</a>

<div class="lang-switch">
  <div>
    <span>Site :</span>
    <button id="site-fr" class="active" onclick="setSiteLang('fr')" type="button">Fran√ßais</button>
    <button id="site-en" onclick="setSiteLang('en')" type="button">English</button>
  </div>
  <div>
    <span>Com radio :</span>
    <button id="comm-fr" onclick="setCommLang('fr')" type="button">Fran√ßais</button>
    <button id="comm-en" class="active" onclick="setCommLang('en')" type="button">English</button>
  </div>
</div>

<div class="options-switch">
  <div>
    <span>Type de vol :</span>
    <button id="flight-vfr" onclick="setFlightType('vfr')" type="button">VFR</button>
    <button id="flight-ifr" class="active" onclick="setFlightType('ifr')" type="button">IFR</button>
  </div>
  <div>
    <span>Cartes :</span>
    <button id="charts-updated" onclick="setChartsStatus('updated')" type="button">√Ä jour</button>
    <button id="charts-outdated" class="active" onclick="setChartsStatus('outdated')" type="button">Pas √† jour</button>
  </div>
</div>

<h1 id="main-title">Communications ATC - Guide des phrases radio VFR</h1>

<div class="info-box">
  <strong>‚ÑπÔ∏è Information importante :</strong><br>
  <span id="info-text">Les communications ATC suivent des proc√©dures strictes. Utilisez toujours les phrases officielles et respectez les instructions du contr√¥leur. En cas de doute, n'h√©sitez pas √† demander des clarifications.</span>
</div>

<form id="atcForm" onsubmit="generatePhrases(event)">

  <!-- Menu d√©roulant alphabet phon√©tique avec convertisseur -->
  <div class="phonetic-helper">
    <details>
      <summary><strong>üéØ Alphabet phon√©tique aviation</strong></summary>
      
      <!-- Convertisseur int√©gr√© -->
      <div style="margin: 15px; padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px;">
        <h4 style="margin: 0 0 10px 0; color: #dc3545;">üîÑ Convertisseur alphabet phon√©tique</h4>
        <label for="phoneticInput">Tapez un mot :</label>
        <input type="text" id="phoneticInput" placeholder="Ex: VJ05" style="margin-bottom: 10px; width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" />
        <div id="phoneticResult" style="background: #e7f3ff; border: 1px solid #b3d9ff; padding: 10px; border-radius: 4px; min-height: 20px; font-weight: bold;">
          Tapez quelque chose pour voir la conversion...
        </div>
      </div>

      <!-- Alphabet phon√©tique -->
      <div class="phonetic-grid">
        <div class="phonetic-item"><strong>A</strong> - Alpha</div>
        <div class="phonetic-item"><strong>B</strong> - Bravo</div>
        <div class="phonetic-item"><strong>C</strong> - Charlie</div>
        <div class="phonetic-item"><strong>D</strong> - Delta</div>
        <div class="phonetic-item"><strong>E</strong> - Echo</div>
        <div class="phonetic-item"><strong>F</strong> - Foxtrot</div>
        <div class="phonetic-item"><strong>G</strong> - Golf</div>
        <div class="phonetic-item"><strong>H</strong> - Hotel</div>
        <div class="phonetic-item"><strong>I</strong> - India</div>
        <div class="phonetic-item"><strong>J</strong> - Juliet</div>
        <div class="phonetic-item"><strong>K</strong> - Kilo</div>
        <div class="phonetic-item"><strong>L</strong> - Lima</div>
        <div class="phonetic-item"><strong>M</strong> - Mike</div>
        <div class="phonetic-item"><strong>N</strong> - November</div>
        <div class="phonetic-item"><strong>O</strong> - Oscar</div>
        <div class="phonetic-item"><strong>P</strong> - Papa</div>
        <div class="phonetic-item"><strong>Q</strong> - Quebec</div>
        <div class="phonetic-item"><strong>R</strong> - Romeo</div>
        <div class="phonetic-item"><strong>S</strong> - Sierra</div>
        <div class="phonetic-item"><strong>T</strong> - Tango</div>
        <div class="phonetic-item"><strong>U</strong> - Uniform</div>
        <div class="phonetic-item"><strong>V</strong> - Victor</div>
        <div class="phonetic-item"><strong>W</strong> - Whiskey</div>
        <div class="phonetic-item"><strong>X</strong> - X-ray</div>
        <div class="phonetic-item"><strong>Y</strong> - Yankee</div>
        <div class="phonetic-item"><strong>Z</strong> - Zulu</div>
      </div>
    </details>
  </div>

  <label for="callsign" data-fr="Callsign (optionnel)" data-en="Callsign (optional)">Callsign (optionnel)</label>
  <input type="text" id="callsign" name="callsign" placeholder="Ex: Victor Juliet Zero Five" />

  <label for="departure" data-fr="D√©part (nom de l'a√©roport)" data-en="Departure (airport name)">D√©part (nom de l'a√©roport)</label>
  <input type="text" id="departure" name="departure" required placeholder="Ex: Paris Charles-de-Gaulle" />

  <label for="parkingDep" data-fr="Place de parking d√©part (obligatoire)" data-en="Departure parking spot (required)">Place de parking d√©part (obligatoire)</label>
  <input type="text" id="parkingDep" name="parkingDep" required placeholder="Ex: A5, G23, Terminal 2E" />

  <label for="atisInfo" data-fr="Information ATIS (obligatoire)" data-en="ATIS information (required)">Information ATIS (obligatoire)</label>
  <input type="text" id="atisInfo" name="atisInfo" required placeholder="Ex: Information Alpha, Information Bravo, Information Charlie..." />

  <label for="arrival" data-fr="Arriv√©e (nom de l'a√©roport)" data-en="Arrival (airport name)">Arriv√©e (nom de l'a√©roport)</label>
  <input type="text" id="arrival" name="arrival" required placeholder="Ex: Paris Orly" />

  <label for="runwayDep" data-fr="Piste d√©part" data-en="Departure runway">Piste d√©part</label>
  <input type="text" id="runwayDep" name="runwayDep" required placeholder="Ex: 27" />

  <label for="runwayArr" data-fr="Piste arriv√©e" data-en="Arrival runway">Piste arriv√©e</label>
  <input type="text" id="runwayArr" name="runwayArr" required placeholder="Ex: 09" />

  <label for="altitude" data-fr="Altitude (pieds) - optionnel" data-en="Altitude (feet) - optional">Altitude (pieds) - optionnel</label>
  <input type="number" id="altitude" name="altitude" placeholder="Ex: 3500 (laissez vide si inconnue)" onchange="toggleAltitudeButtons()" oninput="toggleAltitudeButtons()" />
  
  <!-- Boutons type d'altitude (affich√©s seulement si altitude renseign√©e) -->
  <div id="altitudeTypeButtons" style="display: none; margin-top: 5px;">
    <button type="button" id="alt-type-feet" class="alt-type-btn-small active" onclick="setAltitudeType('feet')" data-fr="Pieds" data-en="Feet">Pieds</button>
    <button type="button" id="alt-type-fl" class="alt-type-btn-small" onclick="setAltitudeType('fl')" data-fr="FL" data-en="FL">FL</button>
  </div>

  <label for="parking" data-fr="Place de parking √† l'arriv√©e - optionnel" data-en="Arrival parking spot - optional">Place de parking √† l'arriv√©e - optionnel</label>
  <input type="text" id="parking" name="parking" placeholder="Ex: G23 (laissez vide si inconnu)" />

  <label for="squawk" data-fr="Code transpondeur (si connu)" data-en="Squawk code (if known)">Code transpondeur (si connu)</label>
  <input type="text" id="squawk" name="squawk" placeholder="Ex: 1200" maxlength="4" />

  <label for="qnh" data-fr="QNH (facultatif)" data-en="QNH (optional)">QNH (facultatif)</label>
  <input type="text" id="qnh" name="qnh" placeholder="Ex: 1013" />

  <button type="submit" data-fr="G√©n√©rer les phrases ATC" data-en="Generate ATC phrases">G√©n√©rer les phrases ATC</button>
</form>

<div id="output" aria-live="polite"></div>

<script>
let siteLang = 'fr';
let commLang = 'en';  // ANGLAIS par d√©faut pour les communications radio
let flightType = 'ifr';
let chartsStatus = 'outdated';
let altitudeType = 'feet';

// Dictionnaire alphabet phon√©tique OACI
const phoneticAlphabet = {
  'A': 'Alpha', 'B': 'Bravo', 'C': 'Charlie', 'D': 'Delta', 'E': 'Echo',
  'F': 'Foxtrot', 'G': 'Golf', 'H': 'Hotel', 'I': 'India', 'J': 'Juliet',
  'K': 'Kilo', 'L': 'Lima', 'M': 'Mike', 'N': 'November', 'O': 'Oscar',
  'P': 'Papa', 'Q': 'Quebec', 'R': 'Romeo', 'S': 'Sierra', 'T': 'Tango',
  'U': 'Uniform', 'V': 'Victor', 'W': 'Whiskey', 'X': 'X-ray', 'Y': 'Yankee',
  'Z': 'Zulu', '0': 'Zero', '1': 'One', '2': 'Two', '3': 'Three', '4': 'Four',
  '5': 'Five', '6': 'Six', '7': 'Seven', '8': 'Eight', '9': 'Nine'
};

// Fonction pour convertir un callsign en alphabet phon√©tique
function convertToPhonetic(callsign) {
  return callsign.toUpperCase().split('').map(char => {
    if (phoneticAlphabet[char]) {
      return phoneticAlphabet[char];
    } else if (char === '-') {
      return '-';
    } else {
      return char; // caract√®res non convertibles (espaces, etc.)
    }
  }).join(' ');
}

// √âcouter les changements dans l'input du convertisseur simplifi√©
document.addEventListener('DOMContentLoaded', function() {
  const phoneticInput = document.getElementById('phoneticInput');
  const phoneticResult = document.getElementById('phoneticResult');
  
  if (phoneticInput && phoneticResult) {
    phoneticInput.addEventListener('input', function() {
      const value = this.value.trim();
      if (value) {
        const phonetic = convertToPhonetic(value);
        phoneticResult.textContent = phonetic;
        phoneticResult.style.color = '#333';
      } else {
        phoneticResult.textContent = 'Tapez quelque chose pour voir la conversion...';
        phoneticResult.style.color = '#666';
      }
    });
  }
});

const infoTexts = {
  fr: {
    vfr_updated: "Communications VFR avec ATC. Utilisez les phrases officielles et respectez les instructions du contr√¥leur. En cas de doute, demandez des clarifications.",
    vfr_outdated: "Communications VFR avec ATC. Privil√©giez les demandes de caps directs plut√¥t que les points de navigation si n√©cessaire.",
    ifr_updated: "Communications IFR avec ATC. Proc√©dures strictes obligatoires. Respectez exactement les clairances et les altitudes assign√©es. Utilisez la phras√©ologie standard.",
    ifr_outdated: "Communications IFR avec ATC. Demandez des vecteurs radar ou caps directs si n√©cessaire."
  },
  en: {
    vfr_updated: "VFR communications with ATC. Use official phraseology and follow controller instructions. When in doubt, ask for clarification.",
    vfr_outdated: "VFR communications with ATC. Prefer direct heading requests over navigation points when needed.",
    ifr_updated: "IFR communications with ATC. Strict procedures mandatory. Follow clearances and assigned altitudes exactly. Use standard phraseology.",
    ifr_outdated: "IFR communications with ATC. Request radar vectors or direct headings as needed."
  }
};

const explanations = {
  fr: {
    vfr_updated: [
      "Premier contact avec la tour de contr√¥le pour demande de d√©part VFR.",
      "Confirmation et r√©p√©tition des √©l√©ments de clairance re√ßus.",
      "Demande de repoussage et d√©marrage moteurs.",
      "Push and start avec direction facing (r√©ponse).",
      "Demande de roulage.",
      "Roulage vers piste avec itin√©raire (r√©ponse).",
      "Pr√™t pour d√©collage.",
      "Autoris√© d√©collage avec cap apr√®s d√©collage.",
      "Contact avec l'approche/d√©part apr√®s d√©collage.",
      "Premier contact avec une nouvelle zone de contr√¥le (check-in).",
      "Demande de changement de niveau de vol.",
      "Contact avec le centre de contr√¥le en route.",
      "Demande de cap direct au lieu d'un point de navigation.",
      "Premier contact avec l'approche de destination.",
      "Demande d'approche directe.",
      "Int√©gration dans le circuit d'a√©rodrome.",
      "Base leg dans le circuit.",
      "Finale avec clearance d'atterrissage.",
      "Lib√©ration de piste et roulage au parking.",
      "Test radio.",
      "Demande de r√©p√©tition (Say again).",
      "Demande de parler plus lentement.",
      "PAN PAN (urgence non vitale).",
      "MAYDAY (urgence vitale)."
    ],
    vfr_outdated: [
      "Premier contact VFR.",
      "Confirmation et r√©p√©tition des √©l√©ments de clairance re√ßus.",
      "Demande de repoussage et d√©marrage moteurs.",
      "Push and start avec direction facing (r√©ponse).",
      "Demande de roulage.",
      "Roulage vers piste avec itin√©raire (r√©ponse).",
      "Pr√™t pour d√©collage.",
      "Autoris√© d√©collage avec cap apr√®s d√©collage.",
      "Contact d√©part, demande vecteurs.",
      "Premier contact avec une nouvelle zone de contr√¥le (check-in).",
      "Demande de changement de niveau de vol.",
      "Contact centre, demande caps directs.",
      "Demande cap direct.",
      "Contact approche destination.",
      "Demande approche directe.",
      "Int√©gration circuit.",
      "Base leg avec demande de confirmation.",
      "Finale avec clearance d'atterrissage.",
      "Lib√©ration de piste et roulage au parking.",
      "Test radio.",
      "Demande de r√©p√©tition (Say again).",
      "Demande de parler plus lentement.",
      "PAN PAN (urgence non vitale).",
      "MAYDAY (urgence vitale)."
    ],
    ifr_updated: [
      "Demande de clairance IFR au d√©part.",
      "Confirmation et r√©p√©tition des √©l√©ments de clairance re√ßus.",
      "Demande de repoussage et d√©marrage moteurs.",
      "Push and start avec direction facing (r√©ponse).",
      "Demande de roulage.",
      "Roulage vers piste avec itin√©raire (r√©ponse).",
      "Pr√™t pour d√©collage IFR.",
      "Autoris√© d√©collage IFR avec cap apr√®s d√©collage.",
      "Contact d√©part apr√®s d√©collage IFR.",
      "Premier contact avec une nouvelle zone de contr√¥le (check-in).",
      "Demande de changement de niveau de vol.",
      "Contact centre en route IFR.",
      "Demande routage direct (d√©viation plan de vol).",
      "Contact approche IFR destination.",
      "Demande approche aux instruments.",
      "Confirmation approche assign√©e.",
      "Intercept localizer ou final.",
      "Finale approche aux instruments.",
      "Atterrissage et lib√©ration de piste.",
      "Test radio.",
      "Demande de r√©p√©tition (Say again).",
      "Demande de parler plus lentement.",
      "PAN PAN (urgence non vitale).",
      "MAYDAY (urgence vitale)."
    ],
    ifr_outdated: [
      "Demande clairance IFR.",
      "Confirmation et r√©p√©tition des √©l√©ments de clairance re√ßus.",
      "Demande de repoussage et d√©marrage moteurs.",
      "Push and start avec direction facing (r√©ponse).",
      "Demande de roulage.",
      "Roulage vers piste avec itin√©raire (r√©ponse).",
      "Pr√™t d√©collage IFR.",
      "Autoris√© d√©collage IFR avec cap apr√®s d√©collage.",
      "Contact d√©part IFR.",
      "Premier contact avec une nouvelle zone de contr√¥le (check-in).",
      "Demande de changement de niveau de vol.",
      "Contact centre, demande vecteurs.",
      "Demande cap direct.",
      "Contact approche IFR.",
      "Demande vecteurs radar.",
      "Demande guidage complet.",
      "Demande vecteurs pour finale.",
      "Finale avec guidage radar.",
      "Atterrissage et demande guidage au sol.",
      "Test radio.",
      "Demande de r√©p√©tition (Say again).",
      "Demande de parler plus lentement.",
      "PAN PAN (urgence non vitale).",
      "MAYDAY (urgence vitale)."
    ]
  },
  en: {
    vfr_updated: [
      "Initial contact with tower for VFR departure clearance.",
      "Readback and confirmation of clearance elements received.",
      "Request for push and start.",
      "Push and start with facing direction (response).",
      "Ready for taxi.",
      "Taxi to runway with route (response).",
      "Ready for takeoff.",
      "Clear for takeoff with heading after takeoff.",
      "Contact with approach/departure after takeoff.",
      "Initial contact with new control zone (check-in).",
      "Request for flight level change.",
      "Contact with area control center enroute.",
      "Request for direct heading instead of navigation point.",
      "Initial contact with destination approach.",
      "Request for direct approach.",
      "Integration into airport circuit.",
      "Base leg in the circuit.",
      "Final with landing clearance.",
      "Runway vacation and taxi to parking.",
      "Radio check.",
      "Request for repetition (Say again).",
      "Request to speak slower.",
      "PAN PAN (non-vital emergency).",
      "MAYDAY (vital emergency)."
    ],
    vfr_outdated: [
      "Initial VFR contact.",
      "Readback and confirmation of clearance elements received.",
      "Request for push and start.",
      "Push and start with facing direction (response).",
      "Ready for taxi.",
      "Taxi to runway with route (response).",
      "Ready for takeoff.",
      "Clear for takeoff with heading after takeoff.",
      "Departure contact with request for vectors.",
      "Initial contact with new control zone (check-in).",
      "Request for flight level change.",
      "Center contact with heading request.",
      "Request direct heading.",
      "Approach contact at destination.",
      "Request direct approach.",
      "Circuit integration.",
      "Base leg with confirmation request.",
      "Final with landing clearance.",
      "Runway vacation and taxi to parking.",
      "Radio check.",
      "Request for repetition (Say again).",
      "Request to speak slower.",
      "PAN PAN (non-vital emergency).",
      "MAYDAY (vital emergency)."
    ],
    ifr_updated: [
      "Request for IFR clearance at departure.",
      "Readback and confirmation of clearance elements received.",
      "Request for push and start.",
      "Push and start with facing direction (response).",
      "Ready for taxi.",
      "Taxi to runway with route (response).",
      "Ready for IFR takeoff.",
      "Clear for IFR takeoff with heading after takeoff.",
      "Departure contact after IFR takeoff.",
      "Initial contact with new control zone (check-in).",
      "Request for flight level change.",
      "Center contact enroute IFR.",
      "Request direct routing (flight plan deviation).",
      "Initial contact with new control zone (check-in).",
      "IFR approach contact at destination.",
      "Request instrument approach.",
      "Confirmation of assigned approach.",
      "Intercept localizer or final.",
      "Final instrument approach.",
      "Landing and runway vacation.",
      "Radio check.",
      "Request for repetition (Say again).",
      "Request to speak slower.",
      "Confirmation of received instructions.",
      "Mandatory IFR position report.",
      "Request IFR radar vector.",
      "Transponder ident.",
      "Frequency change.",
      "Request for emergency priority.",
      "PAN PAN (non-vital emergency).",
      "MAYDAY (vital emergency)."
    ],
    ifr_outdated: [
      "Request IFR clearance.",
      "Readback and confirmation of clearance elements received.",
      "Request for push and start.",
      "Push and start with facing direction (response).",
      "Ready for taxi.",
      "Taxi to runway with route (response).",
      "Ready IFR takeoff.",
      "Clear for IFR takeoff with heading after takeoff.",
      "IFR departure contact.",
      "Initial contact with new control zone (check-in).",
      "Request for flight level change.",
      "Center contact with request for vectors.",
      "Request direct heading.",
      "IFR approach contact.",
      "Request radar vectors.",
      "Request full guidance.",
      "Request vectors to final.",
      "Final with radar guidance.",
      "Landing and request ground guidance.",
      "Radio check.",
      "Request for repetition (Say again).",
      "Request to speak slower.",
      "PAN PAN (non-vital emergency).",
      "MAYDAY (vital emergency)."
    ]
  }
};

const phrases = {
  fr: [
    // Contact initial d√©part - PHRAS√âOLOGIE EXACTE selon demande utilisateur
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo) => {
      // Structure EXACTE : Tour + callsign + parking + type + clearance pour + destination + information ATIS
      let base = `Tour ${dep}, ${callsign || "Victor Juliet Zero Five"}, parking ${parkingDep}, ${flightType.toUpperCase()}, clearance pour ${arr}, information ${atisInfo}`;
      base += '.';
      return `<span class="phrase">${base}</span>`;
    },
    // Confirmation r√©p√©tition clairance (readback)
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo, qnh) => {
      let altText = formatAltitude(alt, altType, 'fr');
      let qnhText = qnh ? `, QNH ${qnh}` : '';
      let base = `Autoris√© ${flightType.toUpperCase()} vers ${arr}, ${altText}, transpondeur ${squawk || "1200"}${qnhText}, ${callsign || "Victor Juliet Zero Five"}`;
      base += '.';
      return `<span class="phrase">${base}</span>`;
    },
    // Demande push and start
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo) => {
      return `<span class="phrase">Tour ${dep}, ${callsign || "Victor Juliet Zero Five"}, demande repoussage et d√©marrage moteurs.</span>`;
    },
    // Push and start facing (nouveau menu d√©roulant)
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo) => {
      return `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, push and start facing <select id="pushDirectionSelect" onchange="updatePushPhrase()" style="display: inline; width: auto; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc;"><option value="">---</option><option value="east">Est</option><option value="west">Ouest</option><option value="north">Nord</option><option value="south">Sud</option></select>.</span>`;
    },
    // Demande roulage
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo) => {
      return `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, ready for taxi.</span>`;
    },
    // Taxi for runway via
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo) => {
      return `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, taxi for runway ${rDep} via <input type="text" id="taxiRouteInput" placeholder="A, B2, holding point..." style="display: inline; width: 300px; padding: 4px; margin: 0 4px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">.</span>`;
    },
    // Pr√™t d√©collage
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo, qnh) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, ready for takeoff runway ${rDep}.</span>`,
    // Autoris√© d√©collage
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo, qnh) => {
      return `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, autoris√© d√©collage piste ${rDep}, apr√®s d√©collage cap <input type="text" placeholder="090" style="display: inline; width: 60px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;"> et contact radar sur <input type="text" placeholder="121.9" style="display: inline; width: 80px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">.</span>`;
    },
    // Contact d√©part IFR
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo, qnh) => {
      let altText = formatAltitude(alt, altType, 'fr');
      return `<span class="phrase"><input type="text" placeholder="Nom de la tour" style="display: inline; width: 150px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">, ${callsign || "Victor Juliet Zero Five"}, climbing ${altText}, ${flightType.toUpperCase()} to ${arr}. Good day, we are passing <input type="text" placeholder="position/altitude" style="display: inline; width: 150px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">.</span>`;
    },
    // Transition zone de contr√¥le
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      return `<span class="phrase"><input type="text" placeholder="Nom de la zone (ex: Paris Control)" style="display: inline; width: 200px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">, ${callsign || "Victor Juliet Zero Five"}, <input type="text" placeholder="position" style="display: inline; width: 120px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">, FL<input type="text" placeholder="095" style="display: inline; width: 60px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">, ${flightType.toUpperCase()} to ${arr}.</span>`;
    },
    // Demande changement altitude
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      return `<span class="phrase"><input type="text" placeholder="Nom contr√¥leur" style="display: inline; width: 120px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">, ${callsign || "Victor Juliet Zero Five"}, request climb FL<input type="text" placeholder="150" style="display: inline; width: 60px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">.</span>`;
    },
    // Contact centre
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = formatAltitude(alt, altType, 'fr') || "niveau actuel";
      let base = `Centre, ${callsign || "Victor Juliet Zero Five"}, ${altText}, ${flightType.toUpperCase()} de ${dep} vers ${arr}`;
      base += '.';
      return `<span class="phrase">${base}</span>`;
    },
    // Demande cap direct
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let capText = takeoffHeading ? "cap " + takeoffHeading + "¬∞ direct" : "cap direct";
      return `<span class="phrase">Centre, ${callsign || "Victor Juliet Zero Five"}, demande ${capText}.</span>`;
    },
    // Contact approche
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = formatAltitude(alt, altType, 'fr') || "niveau actuel";
      let base = `Approche ${arr}, ${callsign || "Victor Juliet Zero Five"}, ${altText}, [position], demande approche ${flightType.toUpperCase()} ${arr}`;
      base += '.';
      return `<span class="phrase">${base}</span>`;
    },
    // Demande approche directe
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Approche ${arr}, demande approche directe piste ${rArr}, ${callsign || "Victor Juliet Zero Five"}.</span>`,
    // Int√©gration circuit
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Tour ${arr}, int√©gration vent ${lr === "left" ? "gauche" : "droite"} piste ${rArr}, ${callsign || "Victor Juliet Zero Five"}.</span>`,
    // Base leg
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Tour ${arr}, base piste ${rArr}, ${callsign || "Victor Juliet Zero Five"}.</span>`,
    // Finale
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Tour ${arr}, finale piste ${rArr}, demande clearance atterrissage, ${callsign || "Victor Juliet Zero Five"}.</span>`,
    // Lib√©ration piste
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let parkingText = parking ? " parking " + parking : " au parking";
      return `<span class="phrase">Tour ${arr}, piste ${rArr} d√©gag√©e, demande roulage${parkingText}, ${callsign || "Victor Juliet Zero Five"}.</span>`;
    },
    // Communications g√©n√©rales...
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Tour ${dep}, test radio, ${callsign || "Victor Juliet Zero Five"}.</span>`,
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Say again please, ${callsign || "Victor Juliet Zero Five"}.</span>`,
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Speak slower please, ${callsign || "Victor Juliet Zero Five"}.</span>`,
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">PAN PAN, PAN PAN, PAN PAN, [nature du probl√®me], position [position], demande assistance, ${callsign || "Victor Juliet Zero Five"}.</span>`,
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">MAYDAY, MAYDAY, MAYDAY, [urgence vitale], position [position], [nombre de personnes] personnes √† bord, ${callsign || "Victor Juliet Zero Five"}.</span>`
  ],
  en: [
    // Initial departure contact - Correct structure  
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo) => {
      let base = `${dep} Tower, ${callsign || "Victor Juliet Zero Five"}, at parking ${parkingDep}, ${flightType.toUpperCase()}, clearance for ${arr}, information ${atisInfo}`;
      base += '.';
      return `<span class="phrase">${base}</span>`;
    },
    // Readback confirmation
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo, qnh) => {
      let altText = formatAltitude(alt, altType, 'en');
      let qnhText = qnh ? `, QNH ${qnh}` : '';
      let base = `Cleared ${flightType.toUpperCase()} to ${arr}, ${altText}, squawk ${squawk || "1200"}${qnhText}, ${callsign || "Victor Juliet Zero Five"}`;
      base += '.';
      return `<span class="phrase">${base}</span>`;
    },
    // Push and start request
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo) => {
      return `<span class="phrase">${dep} Tower, ${callsign || "Victor Juliet Zero Five"}, ready for push and start.</span>`;
    },
    // Push and start facing (nouveau menu d√©roulant)
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo) => {
      return `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, push and start facing <select id="pushDirectionSelectEn" onchange="updatePushPhrase()" style="display: inline; width: auto; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc;"><option value="">---</option><option value="east">East</option><option value="west">West</option><option value="north">North</option><option value="south">South</option></select>.</span>`;
    },
    // Taxi request
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      return `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, ready for taxi.</span>`;
    },
    // Taxi for runway via
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo) => {
      return `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, taxi for runway ${rDep} via <input type="text" id="taxiRouteInputEn" placeholder="A, B2, holding point..." style="display: inline; width: 300px; padding: 4px; margin: 0 4px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">.</span>`;
    },
    // Ready for takeoff
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo, qnh) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, ready for takeoff runway ${rDep}.</span>`,
    // Clear for takeoff
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus, parkingDep, atisInfo, qnh) => {
      return `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, cleared for takeoff runway ${rDep}, after takeoff turn heading <input type="text" placeholder="090" style="display: inline; width: 60px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;"> and contact radar on <input type="text" placeholder="121.9" style="display: inline; width: 80px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">.</span>`;
    },
    // Departure contact
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = formatAltitude(alt, altType, 'en');
      return `<span class="phrase"><input type="text" placeholder="Tower name" style="display: inline; width: 150px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">, ${callsign || "Victor Juliet Zero Five"}, climbing ${altText}, ${flightType.toUpperCase()} to ${arr}. Good day, we are passing <input type="text" placeholder="position/altitude" style="display: inline; width: 150px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">.</span>`;
    },
    // Control zone transition
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      return `<span class="phrase"><input type="text" placeholder="Control zone name (e.g., Paris Control)" style="display: inline; width: 220px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">, ${callsign || "Victor Juliet Zero Five"}, <input type="text" placeholder="position" style="display: inline; width: 120px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">, FL<input type="text" placeholder="095" style="display: inline; width: 60px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">, ${flightType.toUpperCase()} to ${arr}.</span>`;
    },
    // Altitude change request
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      return `<span class="phrase"><input type="text" placeholder="Controller name" style="display: inline; width: 120px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">, ${callsign || "Victor Juliet Zero Five"}, request climb FL<input type="text" placeholder="150" style="display: inline; width: 60px; padding: 2px; margin: 0 2px; font-size: 0.9em; background: white; border: 1px solid #ccc; border-radius: 3px;">.</span>`;
    },
    // Center contact
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = formatAltitude(alt, altType, 'en') || "current level";
      let base = `Center, ${callsign || "Victor Juliet Zero Five"}, ${altText}, ${flightType.toUpperCase()} from ${dep} to ${arr}.`;
      return `<span class="phrase">${base}</span>`;
    },
    // Direct heading request
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let headingText = takeoffHeading ? "heading " + takeoffHeading + " degrees direct" : "direct heading";
      return `<span class="phrase">Center, ${callsign || "Victor Juliet Zero Five"}, request ${headingText}.</span>`;
    },
    // Approach contact
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = formatAltitude(alt, altType, 'en') || "current level";
      let base = `${arr} Approach, ${callsign || "Victor Juliet Zero Five"}, ${altText}, [position], request ${flightType.toUpperCase()} approach ${arr}.`;
      return `<span class="phrase">${base}</span>`;
    },
    // Direct approach request
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${arr} Approach, ${callsign || "Victor Juliet Zero Five"}, request direct approach runway ${rArr}.</span>`,
    // Circuit integration
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${arr} Tower, ${callsign || "Victor Juliet Zero Five"}, entering ${lr} downwind runway ${rArr}.</span>`,
    // Base leg
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${arr} Tower, ${callsign || "Victor Juliet Zero Five"}, turning base runway ${rArr}.</span>`,
    // Final
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${arr} Tower, ${callsign || "Victor Juliet Zero Five"}, final runway ${rArr}, request landing clearance.</span>`,
    // Runway vacation
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let parkingText = parking ? " parking " + parking : " parking";
      return `<span class="phrase">${arr} Tower, ${callsign || "Victor Juliet Zero Five"}, runway ${rArr} vacated, request taxi to${parkingText}.</span>`;
    },
    // General communications...
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${dep} Tower, ${callsign || "Victor Juliet Zero Five"}, radio check.</span>`,
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, say again please.</span>`,
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, speak slower please.</span>`,
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">PAN PAN, PAN PAN, PAN PAN, ${callsign || "Victor Juliet Zero Five"}, [nature of problem], position [position], request assistance.</span>`,
    (dep, arr, rDep, rArr, alt, takeoffHeading, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">MAYDAY, MAYDAY, MAYDAY, ${callsign || "Victor Juliet Zero Five"}, [vital emergency], position [position], [number] souls on board.</span>`
  ]
};

const stepTitles = {
  fr: [
    () => `<div class="step-title">üõ´ D√©part</div>`,
    null, null, null, null, null, null, null,
    () => `<div class="step-title">‚úàÔ∏è En route</div>`,
    null, null, null,
    () => `<div class="step-title">üõ¨ Arriv√©e</div>`,
    null, null, null, null, null,
    () => `<div class="step-title">üìû Communications g√©n√©rales</div>`,
    null, null,
    () => `<div class="step-title">üö® Urgences</div>`,
    null
  ],
  en: [
    () => `<div class="step-title">üõ´ Departure</div>`,
    null, null, null, null, null, null, null,
    () => `<div class="step-title">‚úàÔ∏è Enroute</div>`,
    null, null, null,
    () => `<div class="step-title">üõ¨ Arrival</div>`,
    null, null, null, null, null,
    () => `<div class="step-title">üìû General communications</div>`,
    null, null,
    () => `<div class="step-title">üö® Emergencies</div>`,
    null
  ]
};

// Fonction pour convertir l'altitude en format correct
function formatAltitude(alt, altType, language = 'fr') {
  if (!alt) return language === 'fr' ? "niveau demand√©" : "requested level";
  
  if (altType === 'fl') {
    // Pour Flight Level, on divise par 100 et on arrondit
    const flNumber = Math.round(parseInt(alt) / 100);
    if (flNumber < 10) {
      return `FL${flNumber.toString().padStart(3, '0')}`; // FL045, FL065, etc.
    } else {
      return `FL${flNumber}`; // FL100, FL350, etc.
    }
  } else {
    // Altitude en pieds
    return language === 'fr' ? `${alt} pieds` : `${alt} feet`;
  }
}

function toggleAltitudeButtons() {
  const altitudeInput = document.getElementById('altitude');
  const buttonsDiv = document.getElementById('altitudeTypeButtons');
  
  if (altitudeInput.value.trim()) {
    buttonsDiv.style.display = 'block';
  } else {
    buttonsDiv.style.display = 'none';
  }
}

function getQNHValue() {
  const qnhInput = document.getElementById('qnh');
  return qnhInput.value.trim();
}

function setAltitudeType(type) {
  altitudeType = type;
  
  // Mise √† jour des petits boutons
  const feetBtn = document.getElementById('alt-type-feet');
  const flBtn = document.getElementById('alt-type-fl');
  
  if (feetBtn && flBtn) {
    feetBtn.classList.toggle('active', type === 'feet');
    flBtn.classList.toggle('active', type === 'fl');
  }
  
  // R√©affiche les phrases si d√©j√† g√©n√©r√©es
  if (document.getElementById('output').innerHTML.trim()) {
    generatePhrases(null);
  }
}

function setFlightType(type) {
  flightType = type;
  document.getElementById('flight-vfr').classList.toggle('active', type === 'vfr');
  document.getElementById('flight-ifr').classList.toggle('active', type === 'ifr');
  updateInfoText();
  updateTitle();
  
  // R√©affiche les phrases si d√©j√† g√©n√©r√©es
  if (document.getElementById('output').innerHTML.trim()) {
    generatePhrases(null);
  }
}

function setChartsStatus(status) {
  chartsStatus = status;
  document.getElementById('charts-updated').classList.toggle('active', status === 'updated');
  document.getElementById('charts-outdated').classList.toggle('active', status === 'outdated');
  updateInfoText();
  
  // R√©affiche les phrases si d√©j√† g√©n√©r√©es
  if (document.getElementById('output').innerHTML.trim()) {
    generatePhrases(null);
  }
}

function updateInfoText() {
  const key = `${flightType}_${chartsStatus}`;
  document.getElementById('info-text').textContent = infoTexts[siteLang][key];
}

function updateTitle() {
  const baseTitle = siteLang === 'fr' ? 
    "Communications ATC - Guide des phrases radio " : 
    "ATC Communications - Radio Phrase Guide ";
  document.getElementById('main-title').textContent = baseTitle + flightType.toUpperCase();
}

function setSiteLang(lang) {
  siteLang = lang;
  document.getElementById('site-fr').classList.toggle('active', lang === 'fr');
  document.getElementById('site-en').classList.toggle('active', lang === 'en');
  updateTitle();
  updateInfoText();
  
  // Labels et placeholders
  document.querySelectorAll('label').forEach(label => {
    if (label.dataset[lang]) label.textContent = label.dataset[lang];
  });
  document.querySelector('button[type="submit"]').textContent = document.querySelector('button[type="submit"]').dataset[lang];
  
  // Select options
  document.querySelectorAll('#pushDirection option').forEach(opt => {
    if (opt.dataset[lang]) opt.textContent = opt.dataset[lang];
  });
  
  // Altitude type buttons
  document.querySelectorAll('.alt-type-btn').forEach(btn => {
    if (btn.dataset[lang]) btn.textContent = btn.dataset[lang];
  });
  
  // R√©affiche les phrases si d√©j√† g√©n√©r√©es
  if (document.getElementById('output').innerHTML.trim()) {
    generatePhrases(null);
  }
}

function setCommLang(lang) {
  commLang = lang;
  document.getElementById('comm-fr').classList.toggle('active', lang === 'fr');
  document.getElementById('comm-en').classList.toggle('active', lang === 'en');
  
  // R√©affiche les phrases si d√©j√† g√©n√©r√©es
  if (document.getElementById('output').innerHTML.trim()) {
    generatePhrases(null);
  }
}

function generatePhrases(event) {
  if(event) event.preventDefault();

  let callsign = document.getElementById("callsign").value.trim();
  const depName = document.getElementById("departure").value.trim();
  const parkingDep = document.getElementById("parkingDep").value.trim();
  const atisInfo = document.getElementById("atisInfo").value.trim();
  const arrName = document.getElementById("arrival").value.trim();
  const rDep = document.getElementById("runwayDep").value.trim();
  const rArr = document.getElementById("runwayArr").value.trim();
  const alt = document.getElementById("altitude").value.trim();
  const lr = "left"; // Valeur par d√©faut car le champ leftRight n'existe plus
  const parking = document.getElementById("parking").value.trim();
  const squawk = document.getElementById("squawk").value.trim();
  const qnh = getQNHValue();

  // Validation des champs obligatoires UNIQUEMENT
  if (!depName) {
    alert(siteLang === 'fr' ? 'L\'a√©roport de d√©part est obligatoire.' : 'Departure airport is required.');
    return;
  }
  if (!parkingDep) {
    alert(siteLang === 'fr' ? 'La place de parking au d√©part est obligatoire.' : 'Departure parking spot is required.');
    return;
  }
  if (!atisInfo) {
    alert(siteLang === 'fr' ? 'L\'information ATIS est obligatoire.' : 'ATIS information is required.');
    return;
  }
  if (!arrName) {
    alert(siteLang === 'fr' ? 'L\'a√©roport d\'arriv√©e est obligatoire.' : 'Arrival airport is required.');
    return;
  }
  if (!rDep) {
    alert(siteLang === 'fr' ? 'La piste de d√©part est obligatoire.' : 'Departure runway is required.');
    return;
  }
  if (!rArr) {
    alert(siteLang === 'fr' ? 'La piste d\'arriv√©e est obligatoire.' : 'Arrival runway is required.');
    return;
  }
  
  // Le callsign, l'altitude et le QNH sont OPTIONNELS - pas de validation

  const key = `${flightType}_${chartsStatus}`;
  const phraseList = phrases[commLang];
  const explainList = explanations[siteLang][key];
  const stepList = stepTitles[siteLang];

  let html = "";
  for(let i = 0; i < phraseList.length; i++) {
    // Afficher le titre de section si il existe
    if (stepList[i]) {
      html += stepList[i]();
    }
    // Toujours afficher la phrase (que le titre existe ou non)
    html += `<details><summary>${explainList[i]}</summary>${phraseList[i](depName, arrName, rDep, rArr, alt, "", lr, parking, callsign, squawk, altitudeType, flightType, chartsStatus, parkingDep, atisInfo, qnh)}</details>`;
  }

  document.getElementById("output").innerHTML = html;
}

// Fonction pour mettre √† jour la phrase push and start en temps r√©el
function updatePushPhrase() {
  // Pas besoin de r√©g√©n√©rer toutes les phrases, juste mettre √† jour visuellement
  // La phrase se met √† jour automatiquement via le select int√©gr√©
}

// Initialisation
setSiteLang('fr');
setCommLang('en');  // ANGLAIS par d√©faut pour les communications radio
setFlightType('ifr');
setChartsStatus('outdated');
setAltitudeType('feet');
</script>

</body>
</html>
