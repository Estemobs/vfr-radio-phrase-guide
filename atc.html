<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Communications ATC - VFR Radio Phrase Guide</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 700px;
    margin: 20px auto;
    padding: 10px;
    background: #f0f4f8;
    color: #222;
  }
  h1 {
    text-align: center;
    color: #dc3545;
  }
  .lang-switch {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-bottom: 16px;
  }
  .lang-switch button {
    background: #fce8e6;
    color: #dc3545;
    border: 1px solid #dc3545;
    border-radius: 4px;
    padding: 6px 14px;
    font-weight: bold;
    cursor: pointer;
  }
  .lang-switch button.active {
    background: #dc3545;
    color: #fff;
  }
  .options-switch {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-bottom: 16px;
  }
  .options-switch button {
    background: #fce8e6;
    color: #dc3545;
    border: 1px solid #dc3545;
    border-radius: 4px;
    padding: 6px 14px;
    font-weight: bold;
    cursor: pointer;
  }
  .options-switch button.active {
    background: #dc3545;
    color: #fff;
  }
  .back-button {
    display: inline-block;
    margin-bottom: 20px;
    background: #6c757d;
    color: white;
    text-decoration: none;
    padding: 8px 16px;
    border-radius: 4px;
    font-weight: bold;
  }
  .back-button:hover {
    background: #5a6268;
  }
  label {
    display: block;
    margin-top: 12px;
    font-weight: bold;
  }
  input, select {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
    font-size: 1rem;
    border: 1px solid #bbb;
    border-radius: 4px;
  }
  button[type="submit"] {
    margin-top: 20px;
    background-color: #dc3545;
    color: white;
    border: none;
    padding: 12px 20px;
    font-size: 1.1rem;
    border-radius: 5px;
    cursor: pointer;
  }
  button[type="submit"]:hover {
    background-color: #c82333;
  }
  .phrase {
    background: #fce8e6;
    color: #721c24;
    font-weight: bold;
    padding: 8px 10px;
    border-radius: 4px;
    margin-bottom: 8px;
    display: block;
  }
  details {
    margin-bottom: 12px;
    background: #fff;
    border: 1px solid #f8d7da;
    border-radius: 4px;
    padding: 6px 10px;
  }
  summary {
    font-weight: bold;
    cursor: pointer;
    color: #dc3545;
  }
  .step-title {
    font-weight: bold;
    font-size: 1.15em;
    margin: 18px 0 8px 0;
    color: #dc3545;
  }
  .info-box {
    background: #d1ecf1;
    border: 1px solid #bee5eb;
    border-radius: 4px;
    padding: 15px;
    margin-bottom: 20px;
    color: #0c5460;
  }
  .alt-type-btn {
    background: #fce8e6;
    color: #dc3545;
    border: 1px solid #dc3545;
    border-radius: 4px;
    padding: 6px 12px;
    font-weight: bold;
    cursor: pointer;
  }
  .alt-type-btn.active {
    background: #dc3545;
    color: #fff;
  }
</style>
</head>
<body>

<a href="index.html" class="back-button">← Retour au menu principal</a>

<div class="lang-switch">
  <div>
    <span>Site :</span>
    <button id="site-fr" class="active" onclick="setSiteLang('fr')" type="button">Français</button>
    <button id="site-en" onclick="setSiteLang('en')" type="button">English</button>
  </div>
  <div>
    <span>Com radio :</span>
    <button id="comm-fr" onclick="setCommLang('fr')" type="button">Français</button>
    <button id="comm-en" class="active" onclick="setCommLang('en')" type="button">English</button>
  </div>
</div>

<div class="options-switch">
  <div>
    <span>Type de vol :</span>
    <button id="flight-vfr" onclick="setFlightType('vfr')" type="button">VFR</button>
    <button id="flight-ifr" class="active" onclick="setFlightType('ifr')" type="button">IFR</button>
  </div>
  <div>
    <span>Cartes :</span>
    <button id="charts-updated" onclick="setChartsStatus('updated')" type="button">À jour</button>
    <button id="charts-outdated" class="active" onclick="setChartsStatus('outdated')" type="button">Pas à jour</button>
  </div>
</div>

<h1 id="main-title">Communications ATC - Guide des phrases radio VFR</h1>

<div class="info-box">
  <strong>ℹ️ Information importante :</strong><br>
  <span id="info-text">Les communications ATC suivent des procédures strictes. Utilisez toujours les phrases officielles et respectez les instructions du contrôleur. En cas de doute, n'hésitez pas à demander des clarifications.</span>
</div>

<form id="atcForm" onsubmit="generatePhrases(event)">
  <label for="callsign" data-fr="Callsign (optionnel)" data-en="Callsign (optional)">Callsign (optionnel)</label>
  <input type="text" id="callsign" name="callsign" placeholder="Ex: Victor Juliet Zero Five" />

  <label for="departure" data-fr="Départ (nom de l'aéroport)" data-en="Departure (airport name)">Départ (nom de l'aéroport)</label>
  <input type="text" id="departure" name="departure" required placeholder="Ex: Paris Charles-de-Gaulle" />

  <label for="arrival" data-fr="Arrivée (nom de l'aéroport)" data-en="Arrival (airport name)">Arrivée (nom de l'aéroport)</label>
  <input type="text" id="arrival" name="arrival" required placeholder="Ex: Paris Orly" />

  <label for="runwayDep" data-fr="Piste départ" data-en="Departure runway">Piste départ</label>
  <input type="text" id="runwayDep" name="runwayDep" required placeholder="Ex: 27" />

  <label for="runwayArr" data-fr="Piste arrivée" data-en="Arrival runway">Piste arrivée</label>
  <input type="text" id="runwayArr" name="runwayArr" required placeholder="Ex: 09" />

  <label for="degree" data-fr="Cap (degré) - optionnel" data-en="Heading (degree) - optional">Cap (degré) - optionnel</label>
  <input type="number" id="degree" name="degree" placeholder="Ex: 045 (laissez vide si inconnu)" min="0" max="359" />

  <label for="altitude" data-fr="Altitude (pieds) - optionnel" data-en="Altitude (feet) - optional">Altitude (pieds) - optionnel</label>
  <input type="number" id="altitude" name="altitude" placeholder="Ex: 3500 (laissez vide si inconnue)" />

  <div>
    <label data-fr="Type d'altitude" data-en="Altitude type">Type d'altitude</label>
    <div style="display: flex; gap: 10px; margin-top: 5px;">
      <button type="button" id="alt-type-feet" class="alt-type-btn active" onclick="setAltitudeType('feet')" data-fr="Altitude (pieds)" data-en="Altitude (feet)">Altitude (pieds)</button>
      <button type="button" id="alt-type-fl" class="alt-type-btn" onclick="setAltitudeType('fl')" data-fr="Flight Level" data-en="Flight Level">Flight Level</button>
    </div>
  </div>

  <label for="leftRight" data-fr="Left or Right (downwind)" data-en="Left or Right (downwind)">Left or Right (downwind)</label>
  <select id="leftRight" name="leftRight" required>
    <option value="left" data-fr="Left" data-en="Left">Left</option>
    <option value="right" data-fr="Right" data-en="Right">Right</option>
  </select>

  <label for="parking" data-fr="Place de parking à l'arrivée - optionnel" data-en="Arrival parking spot - optional">Place de parking à l'arrivée - optionnel</label>
  <input type="text" id="parking" name="parking" placeholder="Ex: G23 (laissez vide si inconnu)" />

  <label for="squawk" data-fr="Code transpondeur (si connu)" data-en="Squawk code (if known)">Code transpondeur (si connu)</label>
  <input type="text" id="squawk" name="squawk" placeholder="Ex: 1200" maxlength="4" />

  <button type="submit" data-fr="Générer les phrases ATC" data-en="Generate ATC phrases">Générer les phrases ATC</button>
</form>

<div id="output" aria-live="polite"></div>

<script>
let siteLang = 'fr';
let commLang = 'en';
let flightType = 'ifr';
let chartsStatus = 'outdated';
let altitudeType = 'feet';

const infoTexts = {
  fr: {
    vfr_updated: "Communications VFR avec ATC. Utilisez les phrases officielles et respectez les instructions du contrôleur. En cas de doute, demandez des clarifications.",
    vfr_outdated: "Communications VFR avec ATC - cartes non à jour. Privilégiez les demandes de caps directs plutôt que les points de navigation. Signalez vos cartes non mises à jour.",
    ifr_updated: "Communications IFR avec ATC. Procédures strictes obligatoires. Respectez exactement les clairances et les altitudes assignées. Utilisez la phraséologie standard.",
    ifr_outdated: "Communications IFR avec ATC - cartes non à jour. ATTENTION : Signalez immédiatement vos cartes obsolètes. Demandez des vecteurs radar ou caps directs."
  },
  en: {
    vfr_updated: "VFR communications with ATC. Use official phraseology and follow controller instructions. When in doubt, ask for clarification.",
    vfr_outdated: "VFR communications with ATC - charts not current. Prefer direct heading requests over navigation points. Report your outdated charts.",
    ifr_updated: "IFR communications with ATC. Strict procedures mandatory. Follow clearances and assigned altitudes exactly. Use standard phraseology.",
    ifr_outdated: "IFR communications with ATC - charts not current. WARNING: Report outdated charts immediately. Request radar vectors or direct headings."
  }
};

const explanations = {
  fr: {
    vfr_updated: [
      "Premier contact avec la tour de contrôle pour demande de départ VFR.",
      "Réponse à l'autorisation de départ et confirmation.",
      "Demande de roulage vers la piste.",
      "Demande de décollage immédiat.",
      "Contact avec l'approche/départ après décollage.",
      "Demande de changement d'altitude.",
      "Contact avec le centre de contrôle en route.",
      "Demande de cap direct au lieu d'un point de navigation.",
      "Premier contact avec l'approche de destination.",
      "Demande d'approche directe.",
      "Intégration dans le circuit d'aérodrome.",
      "Base leg dans le circuit.",
      "Finale avec clearance d'atterrissage.",
      "Libération de piste et roulage au parking.",
      "Test radio.",
      "Demande de répétition (Say again).",
      "Demande de parler plus lentement.",
      "Confirmation de réception d'instructions.",
      "Report de position en route.",
      "Demande de vecteur radar.",
      "Ident transpondeur.",
      "Changement de fréquence.",
      "Demande d'urgence priorité.",
      "PAN PAN (urgence non vitale).",
      "MAYDAY (urgence vitale)."
    ],
    vfr_outdated: [
      "Premier contact VFR - signaler cartes non à jour.",
      "Réponse à l'autorisation avec mention cartes obsolètes.",
      "Demande de roulage vers la piste.",
      "Demande de décollage immédiat.",
      "Contact départ - cartes non à jour, demande vecteurs.",
      "Demande de changement d'altitude.",
      "Contact centre - demande caps directs (cartes obsolètes).",
      "Demande cap direct - cartes non mises à jour.",
      "Contact approche - signaler cartes obsolètes.",
      "Demande approche directe - cartes non à jour.",
      "Intégration circuit - demande guidage.",
      "Base leg avec demande de confirmation.",
      "Finale avec clearance d'atterrissage.",
      "Libération de piste et roulage au parking.",
      "Test radio.",
      "Demande de répétition (Say again).",
      "Demande de parler plus lentement.",
      "Confirmation de réception d'instructions.",
      "Report de position avec demande guidage.",
      "Demande vecteur radar (cartes obsolètes).",
      "Ident transpondeur.",
      "Changement de fréquence.",
      "Demande d'urgence priorité.",
      "PAN PAN (urgence non vitale).",
      "MAYDAY (urgence vitale)."
    ],
    ifr_updated: [
      "Demande de clairance IFR au départ.",
      "Confirmation clairance IFR reçue.",
      "Demande de roulage avec clairance IFR.",
      "Prêt pour décollage IFR.",
      "Contact départ après décollage IFR.",
      "Demande changement niveau de vol.",
      "Contact centre en route IFR.",
      "Demande routage direct (déviation plan de vol).",
      "Contact approche IFR destination.",
      "Demande approche aux instruments.",
      "Confirmation approche assignée.",
      "Intercept localizer ou final.",
      "Finale approche aux instruments.",
      "Atterrissage et libération de piste.",
      "Test radio.",
      "Demande de répétition (Say again).",
      "Demande de parler plus lentement.",
      "Confirmation de réception d'instructions.",
      "Report obligatoire de position IFR.",
      "Demande vecteur radar IFR.",
      "Ident transpondeur.",
      "Changement de fréquence.",
      "Demande d'urgence priorité.",
      "PAN PAN (urgence non vitale).",
      "MAYDAY (urgence vitale)."
    ],
    ifr_outdated: [
      "Demande clairance IFR - cartes NON À JOUR.",
      "Confirmation clairance avec signalement cartes obsolètes.",
      "Demande roulage - cartes non mises à jour.",
      "Prêt décollage IFR - cartes obsolètes signalées.",
      "Contact départ IFR - URGENT : cartes non à jour.",
      "Demande changement niveau avec cartes obsolètes.",
      "Contact centre - CARTES NON À JOUR - demande vecteurs.",
      "URGENT : demande cap direct - cartes obsolètes.",
      "Contact approche IFR - CARTES OBSOLÈTES.",
      "Demande vecteurs radar - cartes non à jour.",
      "Demande guidage complet - cartes obsolètes.",
      "Demande vecteurs pour finale - cartes non à jour.",
      "Finale avec guidage radar - cartes obsolètes.",
      "Atterrissage et demande guidage au sol.",
      "Test radio.",
      "Demande de répétition (Say again).",
      "Demande de parler plus lentement.",
      "Confirmation de réception d'instructions.",
      "Report position avec demande vecteurs urgents.",
      "URGENT : vecteur radar - cartes obsolètes.",
      "Ident transpondeur.",
      "Changement de fréquence.",
      "Demande d'urgence priorité.",
      "PAN PAN (urgence non vitale).",
      "MAYDAY (urgence vitale)."
    ]
  },
  en: {
    vfr_updated: [
      "Initial contact with tower for VFR departure clearance.",
      "Response to departure clearance and confirmation.",
      "Request for taxi to runway.",
      "Request for immediate takeoff.",
      "Contact with approach/departure after takeoff.",
      "Request for altitude change.",
      "Contact with area control center enroute.",
      "Request for direct heading instead of navigation point.",
      "Initial contact with destination approach.",
      "Request for direct approach.",
      "Integration into airport circuit.",
      "Base leg in the circuit.",
      "Final with landing clearance.",
      "Runway vacation and taxi to parking.",
      "Radio check.",
      "Request for repetition (Say again).",
      "Request to speak slower.",
      "Confirmation of received instructions.",
      "Position report enroute.",
      "Request for radar vector.",
      "Transponder ident.",
      "Frequency change.",
      "Request for emergency priority.",
      "PAN PAN (non-vital emergency).",
      "MAYDAY (vital emergency)."
    ],
    vfr_outdated: [
      "Initial VFR contact - report charts not current.",
      "Clearance response mentioning outdated charts.",
      "Request for taxi to runway.",
      "Request for immediate takeoff.",
      "Departure contact - charts not current, request vectors.",
      "Request for altitude change.",
      "Center contact - request direct headings (charts outdated).",
      "Request direct heading - charts not updated.",
      "Approach contact - report charts outdated.",
      "Request direct approach - charts not current.",
      "Circuit integration - request guidance.",
      "Base leg with confirmation request.",
      "Final with landing clearance.",
      "Runway vacation and taxi to parking.",
      "Radio check.",
      "Request for repetition (Say again).",
      "Request to speak slower.",
      "Confirmation of received instructions.",
      "Position report with guidance request.",
      "Request radar vector (charts outdated).",
      "Transponder ident.",
      "Frequency change.",
      "Request for emergency priority.",
      "PAN PAN (non-vital emergency).",
      "MAYDAY (vital emergency)."
    ],
    ifr_updated: [
      "Request for IFR clearance at departure.",
      "IFR clearance confirmation received.",
      "Request for taxi with IFR clearance.",
      "Ready for IFR takeoff.",
      "Departure contact after IFR takeoff.",
      "Request flight level change.",
      "Center contact enroute IFR.",
      "Request direct routing (flight plan deviation).",
      "IFR approach contact at destination.",
      "Request instrument approach.",
      "Confirmation of assigned approach.",
      "Intercept localizer or final.",
      "Final instrument approach.",
      "Landing and runway vacation.",
      "Radio check.",
      "Request for repetition (Say again).",
      "Request to speak slower.",
      "Confirmation of received instructions.",
      "Mandatory IFR position report.",
      "Request IFR radar vector.",
      "Transponder ident.",
      "Frequency change.",
      "Request for emergency priority.",
      "PAN PAN (non-vital emergency).",
      "MAYDAY (vital emergency)."
    ],
    ifr_outdated: [
      "Request IFR clearance - charts NOT CURRENT.",
      "Clearance confirmation reporting outdated charts.",
      "Request taxi - charts not updated.",
      "Ready IFR takeoff - outdated charts reported.",
      "IFR departure contact - URGENT: charts not current.",
      "Request level change with outdated charts.",
      "Center contact - CHARTS NOT CURRENT - request vectors.",
      "URGENT: request direct heading - outdated charts.",
      "IFR approach contact - CHARTS OUTDATED.",
      "Request radar vectors - charts not current.",
      "Request full guidance - charts outdated.",
      "Request vectors to final - charts not current.",
      "Final with radar guidance - charts outdated.",
      "Landing and request ground guidance.",
      "Radio check.",
      "Request for repetition (Say again).",
      "Request to speak slower.",
      "Confirmation of received instructions.",
      "Position report requesting urgent vectors.",
      "URGENT: radar vector - charts outdated.",
      "Transponder ident.",
      "Frequency change.",
      "Request for emergency priority.",
      "PAN PAN (non-vital emergency).",
      "MAYDAY (vital emergency)."
    ]
  }
};

const phrases = {
  fr: [
    // Contact initial départ
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let base = `Tour ${dep}, ${callsign || "Victor Juliet Zero Five"}, ${flightType.toUpperCase()} au parking [position], destination ${arr}, demande autorisation de départ.`;
      if (chartsStatus === 'outdated') base += ` Attention : cartes non à jour.`;
      return `<span class="phrase">${base}</span>`;
    },
    // Réponse autorisation
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = alt ? (altType === 'fl' ? 'FL' + alt : alt + " pieds") : "niveau demandé";
      let base = `${callsign || "Victor Juliet Zero Five"}, autorisé ${flightType.toUpperCase()} vers ${arr}, ${altText}, transpondeur ${squawk || "1200"}, rappelez prêt pour roulage.`;
      return `<span class="phrase">${base}</span>`;
    },
    // Demande roulage
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let base = `Tour ${dep}, ${callsign || "Victor Juliet Zero Five"}, prêt pour roulage piste ${rDep}, destination ${arr}.`;
      if (flightType === 'ifr') base += ` Plan de vol IFR activé.`;
      return `<span class="phrase">${base}</span>`;
    },
    // Prêt décollage
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Tour ${dep}, ${callsign || "Victor Juliet Zero Five"}, prêt pour décollage immédiat piste ${rDep}.</span>`,
    // Contact départ
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = alt ? (altType === 'fl' ? 'FL' + alt : alt + " pieds") : "niveau autorisé";
      let base = `Départ ${dep}, ${callsign || "Victor Juliet Zero Five"}, décollé piste ${rDep}, montée ${altText}, ${flightType.toUpperCase()} vers ${arr}.`;
      if (chartsStatus === 'outdated' && flightType === 'ifr') base += ` URGENT : cartes non à jour, demande vecteurs radar.`;
      return `<span class="phrase">${base}</span>`;
    },
    // Demande changement altitude
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let reqText = alt ? "montée " + (altType === 'fl' ? 'FL' + alt : alt + " pieds") : "assignation d'altitude";
      return `<span class="phrase">Départ ${dep}, ${callsign || "Victor Juliet Zero Five"}, demande ${reqText}.</span>`;
    },
    // Contact centre
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = alt ? (altType === 'fl' ? 'FL' + alt : alt + " pieds") : "niveau actuel";
      let base = `Centre, ${callsign || "Victor Juliet Zero Five"}, ${altText}, ${flightType.toUpperCase()} de ${dep} vers ${arr}.`;
      if (chartsStatus === 'outdated') base += ` Cartes non à jour, demande vecteurs.`;
      return `<span class="phrase">${base}</span>`;
    },
    // Demande cap direct
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let capText = deg ? "cap " + deg + "° direct" : "cap direct";
      let reason = chartsStatus === 'outdated' ? " (cartes non à jour)" : " au lieu du point de navigation";
      return `<span class="phrase">Centre, ${callsign || "Victor Juliet Zero Five"}, demande ${capText}${reason}.</span>`;
    },
    // Contact approche
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = alt ? (altType === 'fl' ? 'FL' + alt : alt + " pieds") : "niveau actuel";
      let base = `Approche ${arr}, ${callsign || "Victor Juliet Zero Five"}, ${altText}, [position], demande approche ${flightType.toUpperCase()} ${arr}.`;
      if (chartsStatus === 'outdated') base += ` Cartes obsolètes, demande guidage complet.`;
      return `<span class="phrase">${base}</span>`;
    },
    // Demande approche directe
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Approche ${arr}, ${callsign || "Victor Juliet Zero Five"}, demande approche directe piste ${rArr}.</span>`,
    // Intégration circuit
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Tour ${arr}, ${callsign || "Victor Juliet Zero Five"}, intégration vent ${lr === "left" ? "gauche" : "droite"} piste ${rArr}.</span>`,
    // Base leg
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Tour ${arr}, ${callsign || "Victor Juliet Zero Five"}, base piste ${rArr}.</span>`,
    // Finale
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Tour ${arr}, ${callsign || "Victor Juliet Zero Five"}, finale piste ${rArr}, demande clearance atterrissage.</span>`,
    // Libération piste
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let parkingText = parking ? " parking " + parking : " au parking";
      return `<span class="phrase">Tour ${arr}, ${callsign || "Victor Juliet Zero Five"}, piste ${rArr} dégagée, demande roulage${parkingText}.</span>`;
    },
    // Communications générales...
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Tour ${dep}, ${callsign || "Victor Juliet Zero Five"}, test radio.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, say again please.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, speak slower please.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, Roger, message reçu.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = alt ? (altType === 'fl' ? 'FL' + alt : alt + " pieds") : "niveau actuel";
      return `<span class="phrase">Centre, ${callsign || "Victor Juliet Zero Five"}, position [position], ${altText}, estimé ${arr} dans [temps].</span>`;
    },
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Approche ${arr}, ${callsign || "Victor Juliet Zero Five"}, demande vecteur radar pour l'approche.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, ident.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, changement fréquence [fréquence], au revoir.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">Tour ${dep}, ${callsign || "Victor Juliet Zero Five"}, demande priorité pour [raison].</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">PAN PAN, PAN PAN, PAN PAN, ${callsign || "Victor Juliet Zero Five"}, [nature du problème], position [position], demande assistance.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">MAYDAY, MAYDAY, MAYDAY, ${callsign || "Victor Juliet Zero Five"}, [urgence vitale], position [position], [nombre de personnes] personnes à bord.</span>`
  ],
  en: [
    // Initial departure contact
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let base = `${dep} Tower, ${callsign || "Victor Juliet Zero Five"}, ${flightType.toUpperCase()} at parking [position], destination ${arr}, request departure clearance.`;
      if (chartsStatus === 'outdated') base += ` Charts not current.`;
      return `<span class="phrase">${base}</span>`;
    },
    // Clearance response
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = alt ? (altType === 'fl' ? 'FL' + alt : alt + " feet") : "requested level";
      return `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, cleared ${flightType.toUpperCase()} to ${arr}, ${altText}, squawk ${squawk || "1200"}, report ready for taxi.</span>`;
    },
    // Taxi request
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let base = `${dep} Tower, ${callsign || "Victor Juliet Zero Five"}, ready for taxi runway ${rDep}, destination ${arr}.`;
      if (flightType === 'ifr') base += ` IFR flight plan activated.`;
      return `<span class="phrase">${base}</span>`;
    },
    // Ready for takeoff
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${dep} Tower, ${callsign || "Victor Juliet Zero Five"}, ready for immediate takeoff runway ${rDep}.</span>`,
    // Departure contact
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = alt ? (altType === 'fl' ? 'FL' + alt : alt + " feet") : "cleared level";
      let base = `${dep} Departure, ${callsign || "Victor Juliet Zero Five"}, airborne runway ${rDep}, climbing ${altText}, ${flightType.toUpperCase()} to ${arr}.`;
      if (chartsStatus === 'outdated' && flightType === 'ifr') base += ` URGENT: charts not current, request radar vectors.`;
      return `<span class="phrase">${base}</span>`;
    },
    // Altitude change request
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let reqText = alt ? "climb " + (altType === 'fl' ? 'FL' + alt : alt + " feet") : "altitude assignment";
      return `<span class="phrase">${dep} Departure, ${callsign || "Victor Juliet Zero Five"}, request ${reqText}.</span>`;
    },
    // Center contact
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = alt ? (altType === 'fl' ? 'FL' + alt : alt + " feet") : "current level";
      let base = `Center, ${callsign || "Victor Juliet Zero Five"}, ${altText}, ${flightType.toUpperCase()} from ${dep} to ${arr}.`;
      if (chartsStatus === 'outdated') base += ` Charts not current, request vectors.`;
      return `<span class="phrase">${base}</span>`;
    },
    // Direct heading request
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let headingText = deg ? "heading " + deg + " degrees direct" : "direct heading";
      let reason = chartsStatus === 'outdated' ? " (charts not current)" : " instead of navigation point";
      return `<span class="phrase">Center, ${callsign || "Victor Juliet Zero Five"}, request ${headingText}${reason}.</span>`;
    },
    // Approach contact
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = alt ? (altType === 'fl' ? 'FL' + alt : alt + " feet") : "current level";
      let base = `${arr} Approach, ${callsign || "Victor Juliet Zero Five"}, ${altText}, [position], request ${flightType.toUpperCase()} approach ${arr}.`;
      if (chartsStatus === 'outdated') base += ` Charts outdated, request full guidance.`;
      return `<span class="phrase">${base}</span>`;
    },
    // Direct approach request
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${arr} Approach, ${callsign || "Victor Juliet Zero Five"}, request direct approach runway ${rArr}.</span>`,
    // Circuit integration
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${arr} Tower, ${callsign || "Victor Juliet Zero Five"}, entering ${lr} downwind runway ${rArr}.</span>`,
    // Base leg
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${arr} Tower, ${callsign || "Victor Juliet Zero Five"}, turning base runway ${rArr}.</span>`,
    // Final
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${arr} Tower, ${callsign || "Victor Juliet Zero Five"}, final runway ${rArr}, request landing clearance.</span>`,
    // Runway vacation
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let parkingText = parking ? " parking " + parking : " parking";
      return `<span class="phrase">${arr} Tower, ${callsign || "Victor Juliet Zero Five"}, runway ${rArr} vacated, request taxi to${parkingText}.</span>`;
    },
    // General communications...
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${dep} Tower, ${callsign || "Victor Juliet Zero Five"}, radio check.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, say again please.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, speak slower please.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, Roger, message received.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => {
      let altText = alt ? (altType === 'fl' ? 'FL' + alt : alt + " feet") : "current level";
      return `<span class="phrase">Center, ${callsign || "Victor Juliet Zero Five"}, position [position], ${altText}, estimating ${arr} in [time].</span>`;
    },
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${arr} Approach, ${callsign || "Victor Juliet Zero Five"}, request radar vector for approach.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, ident.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${callsign || "Victor Juliet Zero Five"}, frequency change to [frequency], good day.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">${dep} Tower, ${callsign || "Victor Juliet Zero Five"}, request priority for [reason].</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">PAN PAN, PAN PAN, PAN PAN, ${callsign || "Victor Juliet Zero Five"}, [nature of problem], position [position], request assistance.</span>`,
    (dep, arr, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altType, flightType, chartsStatus) => `<span class="phrase">MAYDAY, MAYDAY, MAYDAY, ${callsign || "Victor Juliet Zero Five"}, [vital emergency], position [position], [number] souls on board.</span>`
  ]
};

const stepTitles = {
  fr: [
    () => `<div class="step-title">🛫 Départ</div>`,
    null, null, null,
    () => `<div class="step-title">✈️ En route</div>`,
    null, null, null,
    () => `<div class="step-title">🛬 Arrivée</div>`,
    null, null, null, null, null,
    () => `<div class="step-title">📞 Communications générales</div>`,
    null, null, null, null, null, null, null,
    () => `<div class="step-title">🚨 Urgences</div>`,
    null, null
  ],
  en: [
    () => `<div class="step-title">🛫 Departure</div>`,
    null, null, null,
    () => `<div class="step-title">✈️ Enroute</div>`,
    null, null, null,
    () => `<div class="step-title">🛬 Arrival</div>`,
    null, null, null, null, null,
    () => `<div class="step-title">📞 General communications</div>`,
    null, null, null, null, null, null, null,
    () => `<div class="step-title">🚨 Emergencies</div>`,
    null, null
  ]
};

function setAltitudeType(type) {
  altitudeType = type;
  document.getElementById('alt-type-feet').classList.toggle('active', type === 'feet');
  document.getElementById('alt-type-fl').classList.toggle('active', type === 'fl');
  
  // Réaffiche les phrases si déjà générées
  if (document.getElementById('output').innerHTML.trim()) {
    generatePhrases();
  }
}

function setFlightType(type) {
  flightType = type;
  document.getElementById('flight-vfr').classList.toggle('active', type === 'vfr');
  document.getElementById('flight-ifr').classList.toggle('active', type === 'ifr');
  updateInfoText();
  updateTitle();
  
  // Réaffiche les phrases si déjà générées
  if (document.getElementById('output').innerHTML.trim()) {
    generatePhrases();
  }
}

function setChartsStatus(status) {
  chartsStatus = status;
  document.getElementById('charts-updated').classList.toggle('active', status === 'updated');
  document.getElementById('charts-outdated').classList.toggle('active', status === 'outdated');
  updateInfoText();
  
  // Réaffiche les phrases si déjà générées
  if (document.getElementById('output').innerHTML.trim()) {
    generatePhrases();
  }
}

function updateInfoText() {
  const key = `${flightType}_${chartsStatus}`;
  document.getElementById('info-text').textContent = infoTexts[siteLang][key];
}

function updateTitle() {
  const baseTitle = siteLang === 'fr' ? 
    "Communications ATC - Guide des phrases radio " : 
    "ATC Communications - Radio Phrase Guide ";
  document.getElementById('main-title').textContent = baseTitle + flightType.toUpperCase();
}

function setSiteLang(lang) {
  siteLang = lang;
  document.getElementById('site-fr').classList.toggle('active', lang === 'fr');
  document.getElementById('site-en').classList.toggle('active', lang === 'en');
  updateTitle();
  updateInfoText();
  
  // Labels et placeholders
  document.querySelectorAll('label').forEach(label => {
    if (label.dataset[lang]) label.textContent = label.dataset[lang];
  });
  document.querySelector('button[type="submit"]').textContent = document.querySelector('button[type="submit"]').dataset[lang];
  
  // Select options
  document.querySelectorAll('#leftRight option').forEach(opt => {
    if (opt.dataset[lang]) opt.textContent = opt.dataset[lang];
  });
  
  // Altitude type buttons
  document.querySelectorAll('.alt-type-btn').forEach(btn => {
    if (btn.dataset[lang]) btn.textContent = btn.dataset[lang];
  });
  
  // Réaffiche les phrases si déjà générées
  if (document.getElementById('output').innerHTML.trim()) {
    generatePhrases();
  }
}

function setCommLang(lang) {
  commLang = lang;
  document.getElementById('comm-fr').classList.toggle('active', lang === 'fr');
  document.getElementById('comm-en').classList.toggle('active', lang === 'en');
  
  // Réaffiche les phrases si déjà générées
  if (document.getElementById('output').innerHTML.trim()) {
    generatePhrases();
  }
}

function generatePhrases(event) {
  if(event) event.preventDefault();

  let callsign = document.getElementById("callsign").value.trim();
  const depName = document.getElementById("departure").value.trim();
  const arrName = document.getElementById("arrival").value.trim();
  const rDep = document.getElementById("runwayDep").value.trim();
  const rArr = document.getElementById("runwayArr").value.trim();
  const alt = document.getElementById("altitude").value.trim();
  const deg = document.getElementById("degree").value.trim();
  const lr = document.getElementById("leftRight").value;
  const parking = document.getElementById("parking").value.trim();
  const squawk = document.getElementById("squawk").value.trim();

  const key = `${flightType}_${chartsStatus}`;
  const phraseList = phrases[commLang];
  const explainList = explanations[siteLang][key];
  const stepList = stepTitles[siteLang];

  let html = "";
  for(let i = 0; i < phraseList.length; i++) {
    if (stepList[i]) {
      html += stepList[i]();
    }
    if (!stepList[i]) {
      html += `<details><summary>${explainList[i]}</summary>${phraseList[i](depName, arrName, rDep, rArr, alt, deg, lr, parking, callsign, squawk, altitudeType, flightType, chartsStatus)}</details>`;
    }
  }

  document.getElementById("output").innerHTML = html;
}

// Initialisation
setSiteLang('fr');
setCommLang('en');
setFlightType('ifr');
setChartsStatus('outdated');
setAltitudeType('feet');
</script>

</body>
</html>
